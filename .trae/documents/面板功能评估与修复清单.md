## 范围定义
- “当前面板”按仓库现状理解为：opencodenpm 的交互菜单与其指向的命令链路（sync/apply/check/verify/fix/build/deploy/full）。核心入口：scripts/core/menu.js 与 scripts/core/cli.js。

## 评估报告（基于代码审阅，不跑真实外部构建/网络）
## 功能状态总结
- **主菜单与子菜单**：可覆盖 sync/apply/build/check/fix/full 等路径；存在“下一步”推荐机制。
- **核心流水线**：
  - sync：更新源码 + 检测新增需汉化文件 + 同步版本号（可选）
  - fix：修复语言包（缺失补齐/质量修复/失效标记）→ apply → build
  - apply：扫描/翻译（可选）→ 验证语言包 → 替换源码 → 质量检查（tsc/其他）
- **状态与反馈**：大量使用 spinner/step/log 输出；大多数失败会 return false 并退出码 1（cli.js）。
- **权限控制**：当前无用户权限/角色体系；属于本地 CLI 工具场景，默认“全权限”。

## 交互流程图（文本版）
- **主入口**：
  - CLI：opencodenpm → 无参数 → menu.select → runCommand → askNextStep 循环
- **推荐闭环（你期望的心智模型）**：
  - sync → fix（写入语言包）→ apply（替换源码）→ build（编译）→ deploy（可选）
- **fix 内部**：
  - （可选）update 官方 → cleanRepo → 标记失效配置 → scanAndTranslate 补齐 → checkQuality 修复 → validate → apply → build

## 发现的问题列表（按严重程度）
### P0/阻塞
1. **verify --translate 运行会崩**：verify 调用 translator.translateNewFiles，但 Translator 类中不存在该方法（仅在 verify.js 有引用）。这会导致“自动翻译新文件”功能不可用。
2. **scripts/package.json 脚本存在悬空命令**：scripts/package.json 里包含 launch/config 脚本，但 cli.js 未注册对应 command，commands 目录也无对应实现，执行会失败。

### P1/高优
3. **语言包文件落盘路径策略不一致**：I18n.smartProcessNewFiles 生成配置路径会包含子目录（如 contexts/context/theme.json），而 Translator.updateLanguagePack 只按类别根目录落盘（如 contexts/theme.json）。虽不一定影响覆盖率统计，但会造成结构混乱、重复配置风险。
4. **质量检查抽样数量参数不一致**：check 命令提供 --limit，但 Translator.showQualityReport 固定抽样逻辑（默认 30），未贯通参数。

### P2/中优
5. **sync 的“删除文件”检测已被弱化**：removedFiles 目前返回空数组，无法提示语言包中已失效的引用（虽 fix 有 deprecated 标记机制，但信息展示缺失）。
6. **菜单/输出一致性**：部分 intro/outro 仍含 emoji（在 plain mode 下期望完全纯文本）；属于体验问题。

## 交互流程优化建议
- **把“验证(verify)”定位为“只检查+可选自动修复到语言包”**，并确保 translate 能跑通（当前是 P0）。
- **统一“写入语言包”的唯一入口**：建议所有新增文件翻译落盘都走同一个“生成 configPath”策略，避免一半走 I18n.generateConfigPath、一半走 Translator.updateLanguagePack。
- **参数贯通**：check --limit → Translator.checkQuality(sampleSize)；并在面板中展示当前抽样数量。
- **信息闭环**：sync 输出“新增需汉化文件”后，直接提示/提供“一键 fix”是正确方向（已有），同时恢复 removedFiles 的提示或在 fix 前置展示 stale 列表。

## 修复优先级排序（建议执行顺序）
1) P0：补齐 Translator.translateNewFiles（或改 verify 不再调用它），并增加单测覆盖。
2) P0：修正/移除 scripts/package.json 中不存在的 launch/config 脚本，或补齐对应命令实现。
3) P1：统一语言包落盘路径策略（Translator.updateLanguagePack 复用 I18n.generateConfigPath）。
4) P1：贯通质量抽样参数（check --limit → sampleSize）。
5) P2：恢复 removedFiles 检测或在 fix 中输出 stale 清单。
6) P2：完善 plain mode 下的 emoji/输出一致性。

## 下一步我将执行的改动（你确认后进入执行）
1. 实现/修正 verify --translate：提供可工作的“新文件翻译→写入语言包→提示 apply”的闭环，并补单测。
2. 对齐 scripts/package.json 与 cli.js：补齐或移除悬空命令，保证所有脚本可运行。
3. 统一语言包配置落盘：让 Translator 更新语言包时调用 I18n.generateConfigPath，结构稳定且可预测。
4. 参数贯通与体验改进：check --limit 生效；输出与 plain mode 一致；补充 removedFiles/stale 提示。
5. 跑 scripts 的 node --test 回归，并补充关键路径测试。